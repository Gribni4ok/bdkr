<!DOCTYPE html>
<html lang="en">
    <head>
        <title>{{title}}</title>
        <link rel="stylesheet" href="/../../css/main.css">
        <link rel="stylesheet" href="/../../css/table.css">
    </head>
    <body>
        {{> header}}
        <div>
            <a href="/lessons/lessons/{{year}}-{{monthnumber}}">Назад</a>
        </div>
        <div>
            <input type="hidden" id="id" value="{{lesson.0.lessonID}}">
        </div>
    <div>
        <table style="width:130%">
            <caption>Подробная информация</caption>
            <tr>
                <th>Дата проведенния</th>
                <th><input disabled readonly name="input" id="date" type="date" class="table-input" value="{{lesson.0.lessondateof}}">
                </th>
            </tr>
            <tr>
                <th>Время проведения</th>
                <th>
                    <select disabled name="input" id="timing"> 
                        <option value = "{{lesson.0.timingID}}">{{lesson.0.timingbegin}} - {{lesson.0.timingend}}</option>
                    </select>
                </th>
            </tr>
            <tr>
                <th>Преподаватель</th>
                <th> <select disabled name="input" id="teacher">
                    <option value="{{lesson.0.teacherID}}">{{lesson.0.teachersurname}} {{lesson.0.teachername}} {{lesson.0.teachermidname}}</option>
                    </select>
                    </th>
            </tr>
            <tr>
                <th>Тема</th>
                <th>
                <select disabled name="input" id="theme">
                <option value="{{lesson.0.themeID}}">{{lesson.0.themename}}</option>
                </select>
                </th>
            </tr>
            <tr>
                <th>Тип занятия</th>
                <th><select disabled name="input" id="type">
                <option value="{{lesson.0.typeID}}">{{lesson.0.typename}}</option>
                </select>
                </th>
            </tr>
            <tr>
                <th>Формат проведения</th>
                <th><select disabled name="input" id="format">
                <option value="{{lesson.0.formatID}}">{{lesson.0.formatname}}</option>
                </select>
                </th>
            </tr>
            <tr>
                <th>Аудитория</th>
                <th><select disabled name="input" id="audience">
                <option value="{{lesson.0.audienceID}}">{{lesson.0.audiencename}}</option>
                </select>
                </th>
            </tr>
            <tr>
                <th>Описание</th>
                <th>
                <input disabled readonly name="input" id="description" class="table-input" value="{{lesson.0.lessondesc}}" />
                </th>
            </tr>
        </table>
        <label>Режим редактирования</label>
        <input type="checkbox" id="toggle-button" class="toggle-button">
        <button id="update-button">Сохранить</button>
    </div>
    </body>
</html>
<script>
        var flag = true;
        document.getElementById('toggle-button').onclick = async function() {
            var inputs = document.getElementsByName('input');
            inputs.forEach((input)=>{
                input.readOnly = !input.readOnly;
                input.disabled = !input.disabled
            });
            if(!flag) return;
            flag = false;

            const url = `/lessons/lesson/update/get`;
            const response = await fetch('/lessons/lesson/update/get', {
                method: 'post',
                headers: {'Content-Type': 'application/json'}
            });
            const res = await response.json();

            var temp = document.getElementById('teacher');
            res.teachers.forEach((teacher)=>{
                let value = teacher.teacherID;
                let option = teacher.teachersurname + " " + teacher.teachername + " " + teacher.teachermidname;
                if(temp.options[0].value != value)
                    temp.appendChild(new Option(option,value));
            });
            
            temp = document.getElementById('type');
            res.types.forEach((type)=>{
                let value = type.typeID;
                let option = type.typename;
                if(temp.options[0].value != value)
                    temp.appendChild(new Option(option,value));
            });

            temp = document.getElementById('format');
            res.formats.forEach((format)=>{
                let value = format.formatID;
                let option = format.formatname;
                if(temp.options[0].value != value)
                    temp.appendChild(new Option(option,value));
            });

            temp = document.getElementById('audience');
            res.audiences.forEach((audience)=>{
                let value = audience.audienceID;
                let option = audience.audiencename;
                if(temp.options[0].value != value)
                    temp.appendChild(new Option(option,value));
            });
            
            temp = document.getElementById('theme');
            res.themes.forEach((theme)=>{
                let value = theme.themeID;
                let option = theme.themename;
                if(temp.options[0].value != value)
                    temp.appendChild(new Option(option,value));
            });

            temp = document.getElementById('timing');
            res.timings.forEach((timing)=>{
                let value = timing.timingID;
                let option = timing.timingbegin + " - " + timing.timingend;
                if(temp.options[0].value != value)
                    temp.appendChild(new Option(option,value));
            });
        };
        document.getElementById('update-button').onclick = async function(){
            var data = {
                lessonID: document.getElementById('id').value,
                lessondateof: document.getElementById('date').value,
                typeID: document.getElementById('type').value,
                teacherID: document.getElementById('teacher').value,
                themeID: document.getElementById('theme').value,
                timingID: document.getElementById('timing').value,
                formatID: document.getElementById('format').value,
                audienceID: document.getElementById('audience').value,
                description: document.getElementById('description').value
            };
            const url = `/lessons/lesson/update`;
            const response = await fetch('/lessons/lesson/update', {
                method: 'post',
                body: JSON.stringify(data),
                headers: {'Content-Type': 'application/json'}
            });
        }
</script>